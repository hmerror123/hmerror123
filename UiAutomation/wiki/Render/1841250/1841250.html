<div class="wikidoc"><h2>Intro</h2>It&#39;s a typical task - to determine the state of a window. Is a button available now? Will be the Next button enabled in four seconds? The majority of testers faced such questions, frequently or rarely.<br /><br />The obvious way is as follows:<br /><div style="color:Black;background-color:White;"><pre>
<span style="color:OrangeRed;">$ErrorActionPreference</span> <span style="color:Gray;">=</span> <span style="color:Gray;">[</span><span style="color:Teal;">System.Management.Automation.ActionPreference</span><span style="color:Gray;">]</span><span style="color:Gray;">::</span>SilentlyContinue
<span style="color:Green;"># we are seeking for the legendary &quot;10&quot; button in Calculator</span>
<span style="color:OrangeRed;">$button</span> <span style="color:Gray;">=</span> Start<span style="color:Gray;">-</span>Process calc <span style="color:Gray;">-</span>PassThru | Get<span style="color:Gray;">-</span>UIAWindow | Get<span style="color:Gray;">-</span>UIAButton <span style="color:Gray;">-</span>n 10
<span style="color:Blue;">if</span> (<span style="color:OrangeRed;">$null</span> <span style="color:Gray;">-ne</span> <span style="color:OrangeRed;">$button</span>) { Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;not null&quot;</span> } <span style="color:Blue;">else</span> { Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;null&quot;</span> }
</pre></div>Here we disabled pipeline interruption (enabled by default) and checked whether a control is null or isn&#39;t.<br /><br />There is a better way (it&#39;s just my opinion. Practicians may argue):<br /><div style="color:Black;background-color:White;"><pre>
<span style="color:OrangeRed;">$ErrorActionPreference</span> <span style="color:Gray;">=</span> <span style="color:Gray;">[</span><span style="color:Teal;">System.Management.Automation.ActionPreference</span><span style="color:Gray;">]</span><span style="color:Gray;">::</span>Continue;
Start<span style="color:Gray;">-</span>Process calc <span style="color:Gray;">-</span>PassThru | Get<span style="color:Gray;">-</span>UIAWindow | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{controltype<span style="color:Gray;">=</span><span style="color:#A31515;">&quot;button&quot;</span>;name<span style="color:Gray;">=</span><span style="color:#A31515;">&quot;10&quot;</span>}
</pre></div>There are two cmdlets for true/false answer, where question is &quot;is there a control ... ?&quot; (Test-UIAControlState) or &quot;will be a control ... available in <i>Timeout</i> seconds?&quot; (Wait-UIAControlState).
<h2>Test-UIAControlState</h2>The Test-UIAControlState checks the state of a window. For example, we need to be sure that today there are buttons 1,3,5 on the Calculator form:<br /><div style="color:Black;background-color:White;"><pre>
Start<span style="color:Gray;">-</span>Process calc <span style="color:Gray;">-</span>PassThru | Get<span style="color:Gray;">-</span>UIAWindow | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{name<span style="color:Gray;">=</span><span style="color:#A31515;">&quot;1&quot;</span>},@{name<span style="color:Gray;">=</span><span style="color:#A31515;">&quot;3&quot;</span>},@{name<span style="color:Gray;">=</span><span style="color:#A31515;">&quot;5&quot;</span>}
</pre></div><h2>Wait-UIAControlState</h2>The Wait-UIAControlState cmdlet does exactly the same.<br /><div style="color:Black;background-color:White;"><pre>
Start<span style="color:Gray;">-</span>Process calc <span style="color:Gray;">-</span>PassThru | Get<span style="color:Gray;">-</span>UIAWindow | Wait<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{name<span style="color:Gray;">=</span><span style="color:#A31515;">&quot;1&quot;</span>},@{na
me<span style="color:Gray;">=</span><span style="color:#A31515;">&quot;3&quot;</span>},@{name<span style="color:Gray;">=</span><span style="color:#A31515;">&quot;5&quot;</span>} <span style="color:Gray;">-</span>Seconds 30
</pre></div>The difference is that this cmdlet is for dynamic applications like wizards or forms that paint controls by some external rule (an order was found in the DB, etc).<br /><br />Note: the window you&#39;ve gotten last is always the current. After successful Get-UIAWindow you can use Get-UIAButton without repeating Get-UIAWindow every time...
<h2>Wait-UIAWindow</h2>In some sutiations, it&#39;s necessary to wait until a window appears. It may be a slow UI, a slow host or a wizard, especially setup wizard. The Wait-UIAWindow cmdlet is an identical twin to the Get-UIAWindow cmdlet with the difference that the first returns $true when the second would return a window, and the first returns $false when the seconds would raise the exception.<br />Typical use of this cmdlet is in conditional constructions:<br /><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">if</span> (Wait<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>pn calc <span style="color:Gray;">-</span>n <span style="color:Gray;">*</span>about<span style="color:Gray;">*</span> <span style="color:Gray;">-</span>Seconds 30) 
{ <span style="color:OrangeRed;">$true</span>; }
<span style="color:Blue;">else</span>
{ <span style="color:OrangeRed;">$false</span>; }
</pre></div><h2>Samples</h2><div style="color:Black;background-color:White;"><pre>
<span style="color:Green;"># Verifies that a control(s) meet(s) provided conditions. Conditions is an array of Hashtables @{AutomationElement.propertyname=value}</span>
ipmo C:\tests\UIAutomation.dll;
Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;start the services.msc snap-in&quot;</span>;
Stop<span style="color:Gray;">-</span>Process <span style="color:Gray;">-</span>Name mmc;
<span style="color:Green;"># now we open the Properties window</span>
Start<span style="color:Gray;">-</span>Process services.msc <span style="color:Gray;">-</span>PassThru | Get<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>p mmc | Get<span style="color:Gray;">-</span>UIADataItem <span style="color:Gray;">-</span>Name BranchCache | Invoke<span style="color:Gray;">-</span>UIAControlContextMenu | Get<span style="color:Gray;">-</span>UIAMenuItem <span style="color:Gray;">-</span>Name Properties | Invoke<span style="color:Gray;">-</span>UIAMenuItemClick;

<span style="color:Green;"># we are checking the OK button</span>
Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;checking the OK button (right)&quot;</span>;
Get<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>p mmc | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;OK&#39;</span>} <span style="color:Gray;">-</span>ver

<span style="color:Green;"># the Cancel button</span>
Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;checking the Cancel button (right)&quot;</span>;
Get<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>p mmc | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;Cancel&#39;</span>} <span style="color:Green;">#-ver</span>

<span style="color:Green;"># the Apply button</span>
Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;checking IsEnabled (wrong IsEnabled because until any changes have been applied to the window, the Appy button is disabled)&quot;</span>;
Get<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>p mmc | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;Apply&#39;</span>;IsEnabled<span style="color:Gray;">=</span><span style="color:OrangeRed;">$true</span>} <span style="color:Green;">#-ver</span>

Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;checking the OK and Cancel buttons (right)&quot;</span>;
Get<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>p mmc | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;OK&#39;</span>},@{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;Cancel&#39;</span>;IsEnabled<span style="color:Gray;">=</span><span style="color:OrangeRed;">$true</span>;IsOffscreen<span style="color:Gray;">=</span><span style="color:OrangeRed;">$false</span>} <span style="color:Green;">#-ver</span>

Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;checking the OK and Cancel buttons (wrong IsOffscreen)&quot;</span>;
Get<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>p mmc | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;OK&#39;</span>},@{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;Cancel&#39;</span>;IsEnabled<span style="color:Gray;">=</span><span style="color:OrangeRed;">$false</span>;IsOffscreen<span style="color:Gray;">=</span><span style="color:OrangeRed;">$false</span>} <span style="color:Green;">#-ver</span>

Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;checking the OK and Cancel buttons (wrong AutomationId)&quot;</span>;
Get<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>p mmc | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;OK&#39;</span>;AutomationId<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;uuu&#39;</span>},@{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;Cancel&#39;</span>;IsEnabled<span style="color:Gray;">=</span><span style="color:OrangeRed;">$true</span>;IsOffscreen<span style="color:Gray;">=</span><span style="color:OrangeRed;">$false</span>} <span style="color:Gray;">-</span>ver

Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;checking the OK and Cancel buttons (wrong parameter name, Exception will be raised)&quot;</span>;
Get<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>p mmc | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;OK&#39;</span>},@{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;Cancel&#39;</span>;IsEnabled<span style="color:Gray;">=</span><span style="color:OrangeRed;">$true</span>;IsOffscreen<span style="color:Gray;">=</span><span style="color:OrangeRed;">$false</span>;LocalizedConrolName<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;sss&#39;</span>} <span style="color:Gray;">-</span>ver

Write<span style="color:Gray;">-</span>Host <span style="color:#A31515;">&quot;checking the OK and Cancel buttons (wrong LocalizedControlType)&quot;</span>;
Get<span style="color:Gray;">-</span>UIAWindow <span style="color:Gray;">-</span>p mmc | Test<span style="color:Gray;">-</span>UIAControlState <span style="color:Gray;">-</span>SearchCriteria @{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;OK&#39;</span>},@{Name<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;Cancel&#39;</span>;IsEnabled<span style="color:Gray;">=</span><span style="color:OrangeRed;">$true</span>;IsOffscreen<span style="color:Gray;">=</span><span style="color:OrangeRed;">$false</span>;LocalizedControlType<span style="color:Gray;">=</span><span style="color:#A31515;">&#39;sss&#39;</span>} <span style="color:Gray;">-</span>ver
</pre></div></div><div class="ClearBoth"></div>